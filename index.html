<!DOCTYPE html>
<html>
<head>
	<title>iMagine</title>
	<script src="libs/jquery.js"></script>
	<script src="libs/jquery_ui_min.js"></script>
	<script src="serversetup.js"></script>
	<script>
		//	Redirect to splash if not logged in
		if (localStorage.username == null) {
			window.location = rootaddress+"/splash.html";
		}
	</script>
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
	<div id="header_bg">
		<div id="navbar">
			<img id="logo" src="images/logo2.png"></img>
			<img id="settings" src="images/settings.png" align="left"></img>
			<img id="compose" src="images/compose.png" align="right"></img>
			<!--<img id="user" src="images/icon.png" align="right"></img>-->
		</div>
	</div>
	<div id="header_border"></div>
	<div id="content">
		<div id="tabs">
			<div id="newtab" class="tab">New</div>
			<div id="goldline"></div>
			<div id="toptab" class="tab">Top</div>
			<div id="goldline"></div>
			<div id="greenlighttab" class="tab">Greenlight</div>
			<div id="goldline"></div>
			<div id="gsstab" class="tab">GSS</div>
			<div id="goldline"></div>
			<div id="hctab" class="tab">HC</div>
			<div id="goldline"></div>
			<div id="inteltab" class="tab">Intel</div>
			<div id="goldline"></div>
			<div id="jhtab" class="tab">J&H</div>
		</div>
		<div id="feed">
			<!--
				The structure of a row in the feed is two columns, one to hold the user icon and the other to hold data.
				The data shows Username and time on the first line, Subject on the second, description on the 3rd and 4th,
				and finally the tool buttons (comment, charge, and flag) for a total of 5 lines.
				<div id="examplerow" style="width:100%; height:120px;">
				<div style="width:50px; float:left; margin-top:15px; margin-left:15px;">
					<img src="images/icon.png"></img>
				</div>
				<div style="width:426px; float:left; margin-top:15px; margin-left:5px; margin-right:15px;">
					<div style="float:left; font-size:11pt; font-weight:bold; color:#00A9A7;">Ty Dang</div><div align="right" style="font-size:8pt; color:#7F8C8D;">5 minutes ago</div>
					<div style="width:426px; height:20px; overflow:hidden; font-size:14pt; color:#B4975A; text-decoration:underline;">This is the subject title line for something super freaking awesome cool</div>
					<div style="width:426px; height:40px; overflow:hidden;">This is the first 20 words of something super awesome cool and awesome and coool and awesome and cool and awesome and cool and awesome and cool and awesome and cool and awesome and cool</div>
					<img src="images/comments.png"></img>
					<img src="images/flags.png"></img>
					<img id="charges" class="charge_button" src="images/charges.png"></img>
				</div>
			</div>
			<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background: url('images/goldline.png');"></div>
			-->
		</div>
		<div id="tools">
			<div id="search">
				Search: <input type="search" style="width:65%;">
			</div>
			<!-- A small AJAX sign up form. Type in username and hit button. test() is ran.
				<button onclick="test()">Click Me!</button>
				Username: <input id="usernametest_input" type="text">
			-->
			<button onclick="test2()">Username?</button>
			<button onclick="test3()">Clear Local Storage</button>
		</div>
	</div>
	<div id="testtest"></div>
	
	<div id="popup_bg"></div>
	<div id="ideaform">
		<div style="width:100%; margin-top:10px; margin-bottom:25px; text-align:center; font-size:26pt; font-weight:bold; color:#00A9A7;">Got An Idea?</div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:10px;">Author: <textarea id="username_input" rows="1" cols="256" maxlength="20" style="width:256px; position:absolute; right:120px; font-size:11px;"></textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:10px;">Title: <textarea id="title_input" rows="1" cols="256" maxlength="20" style="width:256px; position:absolute; right:120px; font-size:11px;"></textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:15px;">Idea: <textarea id="summary_input" rows="1" cols="256" maxlength="140" style="width:256px; position:absolute; right:120px; font-size:11px;"></textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:60px;">Description: <textarea id="description_input" rows="4" cols="256" maxlength="1000" style="width:256px; position:absolute; right:120px; font-size:11px;"></textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:10px;">Sector:
			<select id="sector_input">
				<option value="gss">GSS</option>
				<option value="hc">HC</option>
				<option value="intel">INTEL</option>
				<option value="jh">J&H</option>
			</select>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:10px;">Tags: <textarea id="tags_input" rows="1" cols="256" maxlength="20" style="width:256px; position:absolute; right:120px; font-size:11px;"></textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="font-size:18px; margin-top:10px; margin-bottom:10px;">Picture: <textarea id="image_input"  rows="1" cols="256" maxlength="20" style="width:256px; position:absolute; right:120px; font-size:11px; color:red;">To Be Implemented.</textarea></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div style="width:100%; height:25px; margin-top:10px; margin-bottom:10px;"><input id="ideaform_button" type="submit" style="position:absolute; right:120px;"></div>
		<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>
		<div id="error_input"></div>
	</div>
	
	
	
	
	
	
	
	
	<!--<button type="button" onclick="load()">Load</button>-->

	<script>
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Load the given feed
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		var load = function (feed) {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var temp = '{"results":';
					temp += xmlhttp.responseText;
					temp += '}';
					var json = JSON.parse(temp);
					var tempstr = "";
					for (var i = 0; i < json.results.length; i++) {
						tempstr += '	<div id="idearow" style="width:100%; height:120px;">';
						tempstr += '		<div style="width:50px; float:left; margin-top:15px; margin-left:15px;">';
						tempstr += '			<img src="images/icon.png"></img>';
						tempstr += '		</div>';
						tempstr += '		<div style="width:426px; float:left; margin-top:15px; margin-left:5px; margin-right:15px;">';
						tempstr += '			<div style="float:left; font-size:11pt; font-weight:bold; color:#00A9A7;">'+json.results[i].username+'</div><div align="right" style="font-size:8pt; color:#7F8C8D;">5 minutes ago</div>';
						tempstr += '			<div style="width:426px; height:20px; overflow:hidden; font-size:14pt; color:#B4975A; text-decoration:underline;">'+json.results[i].title+'</div>';
						tempstr += '			<div style="width:426px; height:40px; overflow:hidden;">'+json.results[i].summary+'</div>';
						tempstr += '			<img src="images/comments.png" style="float:left;"></img>';
						tempstr += '			<div id="comments_count" style="color:red; float:left; padding-right:5px;">1</div>';
						tempstr += '			<img src="images/flags.png" style="float:left;"></img>';
						tempstr += '			<div id="flags_count" style="color:red; float:left; padding-right:5px;">0</div>';
						tempstr += '			<img id="charges_'+json.results[i].id+'" class="charge_button" src="images/charges.png" onclick="charge(this.id)" style="float:left;"></img>';
						tempstr += '			<div id="charges_count" style="color:red; float:left; padding-right:5px;">'+json.results[i].charges+'</div>';
						tempstr += '			<img id="idea_'+json.results[i].id+'" src="images/compose.png" width="15" height="15" onclick="goToIdea(this.id)" style="float:left;"></img>';
						if	(json.results[i].greenlight > 0) {
							//	This if statement is poorly written, but will do for now.
							tempstr += '			<img id="greenlight_'+json.results[i].id+'" onclick="greenlight(this.id)" src="images/greenlight.png" width="15" height="15" style="float:left;"></img>';
						}
						else {
							tempstr += '			<img id="greenlight_'+json.results[i].id+'" onclick="greenlight(this.id)" src="images/greenlight_down.png" width="15" height="15" style="float:left;"></img>';
						}
						tempstr += '		</div>';
						tempstr += '	</div>';
						tempstr += '	<div style="width:100%; height:1px; margin-left:1px; margin-top:-1px; background-color:#B4975A;"></div>';
					}
					document.getElementById("feed").innerHTML = tempstr;
				}
			}
			xmlhttp.open("POST", serveraddress+"/"+feed, true);
			xmlhttp.send();
		};
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Submit an idea
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#ideaform_button").click(function() {
			//	Send the form data to server.
			//	Server will see if data can be inserted into database. If so, it will insert.
			//	Server will return an error if error exists
			//	Also, do a reload of feed
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var temp = xmlhttp.responseText;
					//var json = JSON.parse(temp);	//maybe use this in the future to do more accurate error statements
					//if (json["errno"] == "1062")
							//document.getElementById("testcontent").innerHTML = "Username already taken";
					document.getElementById("error_input").innerHTML += temp;
				}
			}
			xmlhttp.open("POST", serveraddress+"/compose", true);
			//xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			var tempPost = "username=";
			tempPost += document.getElementById("username_input").value;
			tempPost += "&title=";
			tempPost += document.getElementById("title_input").value;
			tempPost += "&summary=";
			tempPost += document.getElementById("summary_input").value;
			tempPost += "&description=";
			tempPost += document.getElementById("description_input").value;
			tempPost += "&sector=";
			tempPost += document.getElementById("sector_input").value;
			xmlhttp.send(tempPost);
			
			//	Reload feed
			load(localStorage.feed);
			
			//	Clear the form field
			document.getElementById("username_input").value = "";
			document.getElementById("title_input").value = "";
			document.getElementById("summary_input").value = "";
			document.getElementById("description_input").value = "";
			document.getElementById("tags_input").value = "";
			document.getElementById("image_input").value = "To Be Implemented.";
			document.getElementById("popup_bg").style.display="none";
			document.getElementById("ideaform").style.display="none";
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Charge an idea. Note: Does not account for duplicate charges
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		var charge = function (id_param) {
			//	First get id of charged content
			var id_temp = id_param.split("_");
			var id_temp = id_temp[1];
			
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var temp = xmlhttp.responseText;
					//var json = JSON.parse(temp);	//maybe use this in the future to do more accurate error statements
					//if (json["errno"] == "1062")
							//document.getElementById("testcontent").innerHTML = "Username already taken";
					document.getElementById("error_input").innerHTML += temp;
				}
			}
			xmlhttp.open("POST", serveraddress+"/charge", true);
			var tempPost = "id=";
			tempPost += id_temp;
			xmlhttp.send(tempPost);
			
			//	Reload feed
			load(localStorage.feed);
		};
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Greenlight an idea. Must be logged in as "Admin"
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		var greenlight = function (id_param) {
			if (localStorage.username == "Admin") {
				//	First get id of greenlit content
				var id_temp = id_param.split("_");
				var id_temp = id_temp[1];
				
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function () {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						var temp = xmlhttp.responseText;
						//var json = JSON.parse(temp);	//maybe use this in the future to do more accurate error statements
						//if (json["errno"] == "1062")
								//document.getElementById("testcontent").innerHTML = "Username already taken";
						document.getElementById("error_input").innerHTML += temp;
					}
				}
				xmlhttp.open("POST", serveraddress+"/greenlight", true);
				var tempPost = "id=";
				tempPost += id_temp;
				xmlhttp.send(tempPost);
				
				//	Reload feed
				load(localStorage.feed);
			}
		};
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Click on an idea to see more details, comments, tags, etc. Brings user to a new page
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		var goToIdea = function (id_param) {
			var id_temp = id_param.split("_");
			var id_temp = id_temp[1];
			
			localStorage.id = id_temp;
			window.location = rootaddress+"/idea.html";
		};
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Set local storage feed to newfeed defaultly. Load feed on page load
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		if (localStorage.feed == null)
			localStorage.feed = "newfeed";
		load(localStorage.feed);
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Go to homepage on logo click
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#logo").click(function () {
			window.location = rootaddress+"/index.html";
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Show idea form on compose button click
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#compose").click(function() {
			document.getElementById("popup_bg").style.display="inline";
			document.getElementById("ideaform").style.display="inline";
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Hide idea form if clicked out
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#popup_bg").click(function() {
			document.getElementById("popup_bg").style.display="none";
			document.getElementById("ideaform").style.display="none";
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Change feed to reflect selected tab
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#newtab").click(function () {
			localStorage.feed = "newfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#00FFFA");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#toptab").click(function () {
			localStorage.feed = "topfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#00FFFA");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#gsstab").click(function () {
			localStorage.feed = "gssfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#00FFFA");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#hctab").click(function () {
			localStorage.feed = "hcfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#00FFFA");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#inteltab").click(function () {
			localStorage.feed = "intelfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#00FFFA");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#jhtab").click(function () {
			localStorage.feed = "jhfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#00FFFA");
			$("#greenlighttab").css("color", "#FFFFFF");
		});
		$("#greenlighttab").click(function () {
			localStorage.feed = "greenlightfeed";
			load(localStorage.feed);
			$("#newtab").css("color", "#FFFFFF");
			$("#toptab").css("color", "#FFFFFF");
			$("#gsstab").css("color", "#FFFFFF");
			$("#hctab").css("color", "#FFFFFF");
			$("#inteltab").css("color", "#FFFFFF");
			$("#jhtab").css("color", "#FFFFFF");
			$("#greenlighttab").css("color", "#00FF00");
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Show Tabs changing colors on mouse over and mouse out
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$(".tab").mouseover(function () {
			$(this).css("background", "#00A9A7");
		});
		$(".tab").mouseout(function () {
			$(this).css("background", "#7F8C8D");
		});
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	Show compose button change colors on mouse over and mouse out
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		$("#compose").mouseover(function () {
			$(this).attr('src', 'images/compose_down.png');
		});
		$("#compose").mouseout(function () {
			$(this).attr('src', 'images/compose.png');
		});
		
		
		
		
		var test = function() {
			//	This code makes an AJAX request.
			//	Make a post request to server sending username information
			//	Insert query this data.
			//	If there is an error, dislay an error message to the user
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var temp = xmlhttp.responseText;
					var json = JSON.parse(temp);
					document.getElementById("feed").innerHTML = temp;
					if (json["errno"] == "1062") {
							document.getElementById("feed").innerHTML = "Username already taken";
					}
				}
			}
			xmlhttp.open("POST", serveraddress, true);
			//xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			var tempPost = "username=";
			tempPost += document.getElementById("usernametest_input").value;
			tempPost += "&lname=Ford";
			xmlhttp.send(tempPost);
		};
		
		var test2 = function () {
			alert(localStorage.username);
		};
		
		var test3 = function () {
			localStorage.clear();
			alert("local storage is cleared");
		};
		
		
		
		
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		//	jQuery tools
		//	~~~~~~~*~~~~~~~*~~~~~~~*~~~~~~~*
		
		//	Draggable - add class="draggable" to any html element and it will enable dragging capabilities
		$(function() {
			$(".draggable").draggable();
		});
		
		//	Click - a demonstration on how to invoke event on specific element when clicked
		$("#example").click(function() {
			//	do something cool!
		});
	</script>
</body>
</html>
